#@data/values
#@ load("@ytt:template", "template")

---
#! The namespace in which to deploy Velero.
namespace: velero
#! kind: Deployment
#! Details of the container image to use in the Velero deployment & daemonset (if
#! enabling restic). Required.
image:
  repository: projects.registry.vmware.com/tce
  name: velero/velero
  tag:
  #! Digest value example: sha256:d238835e151cec91c6a811fe3a89a66d3231d9f64d09e5f3c49552672d271f38.
  #! If used, it will take precedence over the image.tag.
  digest: sha256:a99d463670667fbef3363785181317e1dd87c44af808a775fc09046b80c3643f
  pullPolicy: IfNotPresent
  #! One or more secrets to be used when pulling images
  imagePullSecrets: []
  #! - registrySecretName
#! Annotations to add to the Velero deployment's. Optional.
#! If you are using reloader use the following annotation with your VELERO_SECRET_NAME
annotations: {}
#! secret.reloader.stakater.com/reload: "<VELERO_SECRET_NAME>"
#! Annotations to add to the Velero deployment's pod template. Optional.
#! If using kube2iam or kiam, use the following annotation with your AWS_ACCOUNT_ID
#! and VELERO_ROLE_NAME filled in:
podAnnotations: {}
  #!  iam.amazonaws.com/role: "arn:aws:iam::<AWS_ACCOUNT_ID>:role/<VELERO_ROLE_NAME>"
#! Additional pod labels for Velero deployment's template. Optional
#! ref: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: {}

#! Resource requests/limits to specify for the Velero deployment.
#! https://velero.io/docs/v1.6/customize-installation/#customize-resource-requests-and-limits
resources:
  requests:
    cpu: 500m
    memory: 128Mi
  limits:
    cpu: 1000m
    memory: 512Mi
#! Configure the dnsPolicy of the Velero deployment
#! See: https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-policy
dnsPolicy: ClusterFirst
#! Init containers to add to the Velero deployment's pod spec. At least one plugin provider image is required.
initContainers: []
  #! - name: velero-plugin-for-aws
  #!   image: velero/velero-plugin-for-aws:v1.2.0
  #!   imagePullPolicy: IfNotPresent
  #!   volumeMounts:
  #!     - mountPath: /target
  #!       name: plugins
#! Pod security context to use for the Velero deployment. Optional.
#! Set fsGroup for `AWS IAM Roles for Service Accounts`
#! see more informations at: https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html
podSecurityContext: {}
  #! fsGroup: 1337
#! Container Level Security Context for the 'velero' container of the Velero deployment. Optional.
#! See: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container
containerSecurityContext: {}
  #! allowPrivilegeEscalation: false
  #! capabilities:
    #! drop: ["ALL"]
    #! add: []
  #! readOnlyRootFilesystem: true
#! Pod priority class name to use for the Velero deployment. Optional.
priorityClassName: ""
#! Tolerations to use for the Velero deployment. Optional.
tolerations: []
#! Affinity to use for the Velero deployment. Optional.
affinity: {}
#! Node selector to use for the Velero deployment. Optional.
nodeSelector: {}
#! Extra volumes for the Velero deployment. Optional.
extraVolumes: []
#! Extra volumeMounts for the Velero deployment. Optional.
extraVolumeMounts: []
#! Settings for Velero's prometheus metrics. Enabled by default.
metrics:
  enabled: true
  scrapeInterval: 30s
  scrapeTimeout: 10s
  #! service metdata if metrics are enabled
  service:
    annotations: {}
    labels: {}

  #! Pod annotations for Prometheus
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8085"
    prometheus.io/path: "/metrics"

  serviceMonitor:
    enabled: false
    additionalLabels: {}
    #! ServiceMonitor namespace. Default to Velero namespace.
    #! namespace:
#! Cloud provider and storage configurations.
#! backupStorageLocation is how locations where Velero can store backups is represented in the cluster via the
#! BackupStorageLocation CRD. Backupss can be stored in a number of locations, and Velero must have at least one BackupStorageLocation.
#! For documentation, See https://velero.io/docs/v1.6/api-types/backupstoragelocation/.
backupStorageLocation:
  #! name is the name of the backup storage location where backups should be stored. If a name is not provided,
  #! a backup storage location will be created with the name "default". Required.
  name: default
  #! spec contains the general configurations for a backup storage location.
  spec:
    common:
      #! provider is the name of the object store plugin to use to connect to this location.
      #!
      #! Required.
      provider: aws
      #! backupSyncPeriod indicates how frequently Velero should synchronize backups in object storage.
      #! Default is Velero’s server backup sync period. Set this to 0s to disable sync. Optional.
      backupSyncPeriod:
      #! validationFrequency indicates how frequently Velero should validate the object storage (that is
      #! still connected, for example). Default is Velero’s server validation frequency, 1 minute. Set this to 0s to disable validation. Optional.
      validationFrequency:
      #! accessMode is how Velero can access the backup storage location. Valid values are ReadWrite, ReadOnly. Default is ReadWrite. Required.
      accessMode:
      #! credential is a `corev1.SecretKeySelector` containint the credential information to be used with this location. Optional.
    credential:
      #! name of the secret within the Velero namespace which contains the credential information.
      name:
      #! key to use within the secret.
      key:
    #! objectStorage is a set of configurations specific to the object store.
    objectStorage:
      #! bucket is the name of the bucket to store backups in. Required.
      bucket: velero
      #! caCert defines a base64 encoded CA bundle to use when verifying TLS connections to the provider. Optional.
      caCert:
      #! prefix is the directory under which all Velero data should be stored within the bucket. Optional.
      prefix:
    #! configAWS contains sets keys/values to be passed to the object store plugin for the cAWS provider.
    #! It contains configuration for each supported provider.
    #! For configuration, optional and required, for the chosen provider, see: https://velero.io/docs/v1.6/supported-providers/.
    #! Currently this package supports:
    #! - `aws`
    #! - `minio`
    configAWS:
      #! The AWS region where the bucket is located. Queried from the AWS S3 API if not provided. Set to
      #! "minio" if using a local storage service like MinIO.
      #! Note: when used, MinIO must be run as a standalone. See the documentation:
      #! https://docs.min.io/minio/baremetal/installation/deploy-minio-standalone.html.
      #!
      #! Optional.
      region: us-west-2

      #! Whether to use path-style addressing instead of virtual hosted bucket addressing. Set to "true"
      #! if using a local storage service like MinIO.
      #!
      #! Optional (defaults to "false").
      s3ForcePathStyle:

      #! You can specify the AWS S3 URL here for explicitness, but Velero can already generate it from
      #! "region" and "bucket". This field is primarily for local storage services like MinIO.
      #!
      #! Optional.
      s3Url: #! "http://minio:9000"

      #! If specified, use this instead of "s3Url" when generating download URLs (e.g., for logs). This
      #! field is primarily for local storage services like MinIO.
      #!
      #! Optional.
      publicUrl: #! "https://minio.mycluster.com"

      #! The name of the server-side encryption algorithm to use for uploading objects, e.g. "AES256".
      #! If using SSE-KMS and "kmsKeyId" is specified, this field will automatically be set to "aws:kms"
      #! so does not need to be specified by the user.
      #!
      #! Optional.
      serverSideEncryption: #! AES256

      #! Specify an AWS KMS key ID (formatted per the example) or alias (formatted as "alias/<KMS-key-alias-name>")
      #! to enable encryption of the backups stored in S3. Only works with AWS S3 and may require explicitly
      #! granting key usage rights.
      #!
      #! Optional.
      kmsKeyId: #! "502b409c-4da1-419f-a16e-eif453b3i49f"

      #! Version of the signature algorithm used to create signed URLs that are used by velero CLI to
      #! download backups or fetch logs. Possible versions are "1" and "4". Usually the default version
      #! 4 is correct, but some S3-compatible providers like Quobyte only support version 1.
      #!
      #! Optional (defaults to "4").
      signatureVersion:

      #! AWS profile within the credentials file to use for the backup storage location.
      #!
      #! Optional (defaults to "default").
      profile:

      #! Set this to "true" if you do not want to verify the TLS certificate when connecting to the
      #! object store -- like for self-signed certs with MinIO. This is susceptible to man-in-the-middle
      #! attacks and is not recommended for production.
      #!
      #! Optional (defaults to "false").
      insecureSkipTLSVerify:
  #! Parameters for the `default` VolumeSnapshotLocation. See
  #! https://velero.io/docs/v1.6/api-types/volumesnapshotlocation/
  volumeSnapshotLocation:
    #! Whether to create volumesnapshotlocation cr, if false => disable snapshot feature
    snapshotsEnabled: false
    #! name is the name of the volume snapshot location where snapshots are being taken. Required.
    name:
    #! provider is the name for the volume snapshot provider. If omitted
    #! `configuration.provider` will be used instead.
    provider: aws
    #! Additional provider-specific configuration. See link above
    #! for details of required/optional fields for your provider.
    config: {}
  #!    region:
  #!    apiTimeout:
  #!    resourceGroup:
  #!    The ID of the subscription where volume snapshots should be stored, if different from the cluster’s subscription. If specified, also requires `configuration.volumeSnapshotLocation.config.resourceGroup`to be set. (Azure only)
  #!    subscriptionId:
  #!    incremental:
  #!    snapshotLocation:
  #!    project:
  #! These are server-level settings passed as CLI flags to the `velero server` command. Velero
  #! uses default values if they're not passed in, so they only need to be explicitly specified
  #! here if using a non-default value. The `velero server` default values are shown in the
  #! comments below.
  #! --------------------
  #! `velero server` default: 1m
  backupSyncPeriod:
  #! `velero server` default: 1h
  resticTimeout:
  #! `velero server` default: namespaces,persistentvolumes,persistentvolumeclaims,secrets,configmaps,serviceaccounts,limitranges,pods
  restoreResourcePriorities:
  #! `velero server` default: false
  restoreOnlyMode:
  #! `velero server` default: 20.0
  clientQPS:
  #! `velero server` default: 30
  clientBurst:
  #! `velero server` default: empty
  disableControllers:
  #! additional key/value pairs to be used as environment variables such as "AWS_CLUSTER_NAME: 'yourcluster.domain.tld'"
  extraEnvVars: {}
  #! Comma separated list of velero feature flags. default: empty
  features:
  #! Set log-level for Velero pod. Default: info. Other options: debug, warning, error, fatal, panic.
  logLevel:
  #! Set log-format for Velero pod. Default: text. Other option: json.
  logFormat:
  #! Set true for backup all pod volumes without having to apply annotation on the pod when used restic Default: false. Other option: false.
  defaultVolumesToRestic:
#! End of backup/snapshot location settings.
#! Settings for additional Velero resources.
rbac:
  #! Whether to create the Velero role and role binding to give all permissions to the namespace to Velero.
  create: false
  #! Whether to create the cluster role binding to give administrator permissions to Velero
  clusterAdministrator: false
  name: velero
  roleRefName: cluster-admin
  clusterRoleAPIGroups: [""]
  clusterRoleverbs: ["get", "watch", "list"]
#! Information about the Kubernetes service account Velero uses.
serviceAccount:
  name: velero
  annotations:
  labels:
#! Info about the secret to be used by the Velero deployment, which
#! should contain credentials for the cloud provider IAM account you've
#! set up for Velero.
credential:
  #! Whether a secret should be used as the source of IAM account
  #! credentials. Set to false if, for example, using kube2iam or
  #! kiam to provide IAM credentials for the Velero pod.
  useSecret: true
  #! Name of the secret to create if `useSecret` is true and `existingSecret` is empty
  name: cloud-credentials
  key:
  #! Name of a pre-existing secret (if any) in the Velero namespace
  #! that should be used to get IAM account credentials. Optional.
  existingSecret:
  #! Data to be stored in the Velero secret, if `useSecret` is true and `existingSecret` is empty.
  #! As of the current Velero release, Velero only uses one secret key/value at a time.
  #! The key must be named `cloud`, and the value corresponds to the entire content of your IAM credentials file.
  #! Note that the format will be different for different providers, please check their documentation.
  #! Here is a list of documentation for plugins maintained by the Velero team:
  #! [AWS] https://github.com/vmware-tanzu/velero-plugin-for-aws/blob/main/README.md
  #! [GCP] https://github.com/vmware-tanzu/velero-plugin-for-gcp/blob/main/README.md
  #! [Azure] https://github.com/vmware-tanzu/velero-plugin-for-microsoft-azure/blob/main/README.md
  secretContents:
      cloud: |
  #!  cloud: |
  #!    [default]
  #!    aws_access_key_id=<REDACTED>
  #!    aws_secret_access_key=<REDACTED>
  #! additional key/value pairs to be used as environment variables such as "DIGITALOCEAN_TOKEN: <your-key>". Values will be stored in the secret.
  extraEnvVars: {}
  #! Name of a pre-existing secret (if any) in the Velero namespace
  #! that will be used to load environment variables into velero and restic.
  #! Secret should be in format - https://kubernetes.io/docs/concepts/configuration/secret/#use-case-as-container-environment-variables
  extraSecretRef: ""

#! Whether to deploy the restic daemonset.
deployRestic: false
restic:
  podVolumePath: /var/lib/kubelet/pods
  privileged: false
  #! Pod priority class name to use for the Restic daemonset. Optional.
  priorityClassName: ""
  #! Resource requests/limits to specify for the Restic daemonset deployment. Optional.
  #! https://velero.io/docs/v1.6/customize-installation/#customize-resource-requests-and-limits
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1024Mi
  #! Tolerations to use for the Restic daemonset. Optional.
  tolerations: []
  #! Annotations to set for the Restic daemonset. Optional.
  annotations: {}
  #! labels to set for the Restic daemonset. Optional.
  labels: {}
  #! Extra volumes for the Restic daemonset. Optional.
  extraVolumes: []
  #! Extra volumeMounts for the Restic daemonset. Optional.
  extraVolumeMounts: []
  #! Configure the dnsPolicy of the Restic daemonset
  #! See: https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-policy
  dnsPolicy: ClusterFirst
  #! Pod security Context to use for the restic deployment. Optional.
  #! Set fsGroup for `AWS IAM Roles for Service Accounts`
  #! see more informations at: https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html
  podSecurityContext: {}
    #! runAsUser: 0
    #! fsGroup: 1337
  #! Node selector to use for the Restic daemonset. Optional.
  nodeSelector: {}
#! Backup schedules to create.
#! Eg:
#! schedules:
#!   mybackup:
#!     disabled: false
#!     labels:
#!       myenv: foo
#!     annotations:
#!       myenv: foo
#!     schedule: "0 0 * * *"
#!     useOwnerReferencesInBackup: true
#!     template:
#!       ttl: "240h"
#!       includedNamespaces:
#!       - foo
schedules: {}
#! Velero ConfigMaps.
#! Eg:
#! configMaps:
#!   restic-restore-action-config:
#!     labels:
#!       velero.io/plugin-config: ""
#!       velero.io/restic: RestoreItemAction
#!     data:
#!       image: velero/velero-restic-restore-helper:v1.6.0
configMaps: {}
#! End of additional Velero resource settings.
