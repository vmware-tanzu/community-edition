#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:data", "data")

#! We are adding this overlay in the package to accommodate the need from vSphere supervisor cluster:
#! `deployment.spec.strategy.type` is configured to `RollingUpdate`
#! `deployment.spec.strategy.rollingUpdate.maxUnavailable` is set to `0`.
#! `deployment.spec.strategy.rollingUpdate.maxSurge` is set to `1`.
#! `deployment.spec.template.spec.nodeSelector`is set to target only `Nodes`
#! `daemonset.spec.updateStrategy.type` is configured to `OnDelete`
#! This overlay makes configuring the above parameters possible
#! Reference: https://github.com/vmware-tanzu/tanzu-framework/issues/1850


#@overlay/match expects="0+",by=overlay.subset({"kind":"DaemonSet"})
---
kind: DaemonSet
spec:
  #@ if data.values.daemonset.updateStrategy:
  #@overlay/match missing_ok=True
  updateStrategy:
    type: #@ data.values.daemonset.updateStrategy
  #@ end
